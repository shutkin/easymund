# Easymund
Простой и надёжный сервис аудио-конференций.

# Структура проекта

## server
Монолитное приложение, реализующее весь функционал бэкенда сервиса в одном исполняемом файле.
Использует asynchronous runtime Tokio.

### httpserver.rs
Реализация HTTP сервера.

На старте рекурсивно читает все файлы в указанной директории в память с сохранением относительного пути и имени.
При обслуживании GET запроса выдаёт контент прочитанного файла с именем и путём соответствующему пути в запросе.
При обслуживании POST запроса вызывает внешний обработчик PostHandler с передачей пути и телом запроса и 
возвращает результат его работы.

### wsserver.rs
Реализация WebSocket сервера. Частично переиспользует код из httpserver.rs.

Включает в себя структуру WSClientEvent - объект взаимодействия с вышестоящим слоем абстракции.
Для взаимодействия с вышестоящим слоем используется канал Tokio Multiple Producer Single Consumer (mpsc).

### easymund.rs
Ядро сервиса. Описывает структуру Easymund с контекстом, включающим в себя все данные для работы сервиса.

Взаимодействует с wsserver.rs с помощью канала mpsc и с httpserver.rs реализуя объект PostHandler в котором создаёт 
новые конференции. Обрабатывает сценарии подключения и отключения WebSocket клиентов. 
Периодически с заданным интервалом запускает процедуру передачи аудио данных клиентам.

Принимает аудио данные от клиентов с записью в память. Принимает команды от клиентов в формате JSON с делегацией их 
обработки в event_handler.rs. При отключении клиента записывает все полученные от него аудио данные в один wav файл.

### ambience.rs
Объект для работы с фоновыми звуками.

### event_handler.rs
Использует паттер Strategy для обработки команд от клиентов. Принимает запрос от клиента в формате JSON, в результате 
обработки которого отправляет нужные команды другим пользователям.

### dto.rs
Модель для клиентских команд.

### main.rs
Точка входа приложения.

- Инициирует систему логирования.
- Создаёт mpsc каналы для связи wsserver.rs и easymund.rs.
- Запускает WebSocket сервер с созданными mpsc каналами.
- Создаёт экземпляр объекта Easymund.
- Запускает HTTP сервер с обработчиком POST запросов полученным из объекта Easymund.
- Запускает Easymund с созданными mpsc каналами.

## codec

Библиотека для кодирования и декодирования аудио данных. 
Использует [flacenc](https://docs.rs/flacenc/0.3.1/flacenc/) для кодирования в FLAC и 
[symphonia](https://docs.rs/symphonia/0.5.4/symphonia/) для декодирования из FLAC. Используется как на сервере 
так и на клиенте.

## client-processor

Обработчика аудио данных на клиенте. Собирается в WASM файл.

## vue-client

Клиент сервиса.

## client

Файлы сборки клиента с сборкой библиотеки client-processor.

